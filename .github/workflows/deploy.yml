name: Deploy to Railway

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check Railway Token
        id: check_token
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          if [ -n "$RAILWAY_TOKEN" ]; then
            echo "has_token=true" >> $GITHUB_OUTPUT
            echo "âœ… Railway token found"
          else
            echo "has_token=false" >> $GITHUB_OUTPUT
            echo "âš ï¸ Railway token not found - skipping deployment"
          fi

      - name: Install Railway CLI
        if: steps.check_token.outputs.has_token == 'true'
        run: npm install -g @railway/cli

      - name: Deploy to Railway
        if: steps.check_token.outputs.has_token == 'true'
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          echo "ğŸš€ Deploying to Railway..."
          railway up --service jayti
          echo "âœ… Deployment triggered"
          
      - name: Verify Build (No Token)
        if: steps.check_token.outputs.has_token == 'false'
        run: |
          echo "âš ï¸ No Railway token configured"
          echo "ğŸ“‹ To enable auto-deployment:"
          echo "   1. Go to Railway.app â†’ Account â†’ Tokens"
          echo "   2. Generate a token"
          echo "   3. Add to GitHub Secrets as RAILWAY_TOKEN"
          echo "âœ… Build is valid and ready for manual deployment"
